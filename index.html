<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>مكتبة العالم — احترافي</title>

<!-- Tailwind (CDN) to speed styling -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background: linear-gradient(180deg,#081028,#021024); color: #e6eef8; font-family: Inter, system-ui, "Noto Naskh Arabic", sans-serif; }
  .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(6px); border: 1px solid rgba(255,255,255,0.04); }
  .btn-accent { background: linear-gradient(90deg,#06b6d4,#7c3aed); color:#001; }
  .tab-scroll { -webkit-overflow-scrolling: touch; scrollbar-width: none; }
  .tab-scroll::-webkit-scrollbar { display: none; }
  .fade { transition: all .18s ease; }
  .small-muted { color:#9fb3d6; font-size:13px; }
  .ad-overlay { position: fixed; inset:0; display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6); z-index:60; }
</style>
</head>
<body>

<div class="max-w-6xl mx-auto p-4 md:p-8">
  <!-- Header -->
  <header class="flex items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl md:text-4xl font-extrabold">📚 مكتبة العالم</h1>
      <p class="small-muted">واجهـة فخمة، دعم الجوال والحاسوب — نشر سريع وإدارة مرنة</p>
    </div>

    <div class="flex items-center gap-3">
      <button id="customerAreaBtn" class="px-3 py-2 rounded-full btn-accent shadow">مساحة الزبون</button>
      <button id="openAdmin" class="px-3 py-2 rounded-full glass">⋮</button>
    </div>
  </header>

  <!-- Tabs -->
  <section class="mt-6">
    <div class="tab-scroll flex gap-3 overflow-x-auto py-2">
      <!-- tabs inserted by JS -->
    </div>
  </section>

  <!-- Search & actions -->
  <section class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 items-center">
    <form id="searchForm" class="col-span-2 flex gap-2" onsubmit="return false;">
      <input id="kw" class="flex-1 p-3 rounded-lg glass border border-slate-700" placeholder="ابحث بالكلمات المفتاحية داخل الخانة الحالية (مثال: رياضة,تمارين)" />
      <button id="doSearch" class="px-4 rounded-lg btn-accent">🔎 بحث</button>
    </form>

    <div class="flex gap-2 justify-end">
      <button id="newPostBtn" class="px-4 py-2 rounded-lg glass">➕ نشر (ADM/كود)</button>
      <button id="promoteBtn" class="px-4 py-2 rounded-lg btn-accent">انشر 7 أيام بـ $3</button>
    </div>
  </section>

  <!-- Content -->
  <main class="mt-6">
    <div id="content" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

    <div id="compareView" class="mt-6 glass p-4 rounded-lg hidden">
      <h3 class="font-bold">📱 مقارنة الهواتف</h3>
      <table class="w-full mt-3 text-center">
        <thead><tr class="text-sm text-slate-300"><th class="p-2">الهاتف</th><th class="p-2">الرام</th><th class="p-2">التخزين</th><th class="p-2">البطارية</th></tr></thead>
        <tbody id="compareTable"></tbody>
      </table>
    </div>
  </main>

  <footer class="mt-8 small-muted text-center">ارفع هذا الملف كـ index.html في root المستودع وفعل GitHub Pages.</footer>
</div>

<!-- Admin Modal -->
<div id="adminModal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="w-full max-w-2xl p-6 rounded-xl glass">
    <div class="flex justify-between items-center">
      <div>
        <h2 class="font-bold text-lg">لوحة الأدمن ⚙️</h2>
        <p class="small-muted">نظام آمن client-only — لا يتم عرض كلمة المرور.</p>
      </div>
      <div class="flex gap-2">
        <button id="shareFB" class="px-3 py-2 rounded-lg btn-accent">روج لإعلانك</button>
        <button id="closeAdmin" class="px-3 py-2 rounded-lg glass">إغلاق</button>
      </div>
    </div>

    <hr class="my-4 border-slate-700">

    <!-- Login area -->
    <div id="adminLogin" class="">
      <label class="small-muted">أدخل كلمة الأدمن</label>
      <div class="mt-2 flex gap-2">
        <input id="adminPass" type="password" class="flex-1 p-3 rounded-lg glass" placeholder="كلمة الأدمن" />
        <button id="adminConfirm" class="px-4 py-2 rounded-lg btn-accent">دخول</button>
      </div>
    </div>

    <!-- Panel -->
    <div id="adminPanel" class="hidden mt-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div class="glass p-3 rounded-lg">
          <div class="font-semibold">🔑 توليد كود</div>
          <div class="mt-2 small-muted">كود صالح لمرة واحدة — أعطه للزبون.</div>
          <div class="mt-3 flex gap-2">
            <button id="genCode" class="px-3 py-2 rounded-lg btn-accent">توليد كود</button>
            <button id="showCodes" class="px-3 py-2 rounded-lg glass">عرض الأكواد</button>
          </div>
        </div>

        <div class="glass p-3 rounded-lg">
          <div class="font-semibold">📣 رفع إعلان</div>
          <div class="mt-2 small-muted">رفع صورة/فيديو ليشاهده الزوار.</div>
          <input id="adFile" type="file" class="mt-2" />
          <div class="mt-2 flex gap-2">
            <select id="adType" class="p-2 rounded-lg glass">
              <option value="video">فيديو (24s)</option>
              <option value="image">صورة (5s)</option>
            </select>
            <button id="uploadAd" class="px-3 py-2 rounded-lg btn-accent">رفع</button>
          </div>
        </div>

        <div class="glass p-3 rounded-lg">
          <div class="font-semibold">📊 الإحصاءات</div>
          <div class="mt-2 small-muted">محفوظة محلياً</div>
          <div class="mt-3 space-y-2">
            <div class="flex justify-between"><span>👥 إجمالي زوار</span><span id="statTotal" class="font-semibold">0</span></div>
            <div class="flex justify-between"><span>🔗 من فيسبوك</span><span id="statFB" class="font-semibold">0</span></div>
            <div class="flex justify-between"><span>🌍 مباشرة</span><span id="statDirect" class="font-semibold">0</span></div>
          </div>
        </div>
      </div>

      <div id="codesBox" class="mt-4 glass p-3 rounded-lg hidden"></div>

      <hr class="my-4 border-slate-700" />

      <div>
        <h3 class="font-semibold">نشر يدوي (الأدمن)</h3>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <input id="pTitle" placeholder="عنوان" class="p-3 rounded-lg glass" />
          <input id="pKw" placeholder="كلمات مفتاحية (مفصولة بفواصل)" class="p-3 rounded-lg glass" />
          <textarea id="pDesc" placeholder="وصف" class="p-3 rounded-lg glass col-span-2"></textarea>
          <select id="pCat" class="p-3 rounded-lg glass">
            <!-- filled by JS -->
          </select>
          <input id="pFiles" type="file" multiple class="col-span-2" />
          <div class="col-span-2 flex gap-2">
            <button id="publishNow" class="px-4 py-2 rounded-lg btn-accent">نشر الآن</button>
            <button id="logoutAdmin" class="px-4 py-2 rounded-lg glass">تسجيل خروج</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Customer Modal -->
<div id="customerModal" class="fixed inset-0 hidden items-center justify-center z-40">
  <div class="w-full max-w-xl p-6 rounded-xl glass">
    <div class="flex justify-between">
      <h3 class="font-bold">مساحة الزبون</h3>
      <button id="closeCustomer" class="px-3 py-1 rounded-lg glass">إغلاق</button>
    </div>

    <div class="mt-3">
      <label class="small-muted">أدخل كود النشر</label>
      <div class="flex gap-2 mt-2">
        <input id="customerCode" class="flex-1 p-3 rounded-lg glass" placeholder="ادخل الكود" />
        <button id="redeemCode" class="px-3 py-2 rounded-lg btn-accent">تحقق</button>
      </div>

      <div id="customerFormWrap" class="mt-4 hidden">
        <p class="small-muted">الكود صالح — يمكنك نشر منشور واحد فقط.</p>
        <input id="custTitle" placeholder="العنوان" class="p-3 rounded-lg glass mt-2" />
        <input id="custKw" placeholder="كلمات مفتاحية" class="p-3 rounded-lg glass mt-2" />
        <textarea id="custDesc" placeholder="الوصف" class="p-3 rounded-lg glass mt-2"></textarea>
        <select id="custCat" class="p-3 rounded-lg glass mt-2"></select>
        <input id="custFiles" type="file" multiple class="mt-2" />
        <div class="mt-3 flex gap-2">
          <button id="custPublish" class="px-4 py-2 rounded-lg btn-accent">نشر المنشور</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ad Modal -->
<div id="adModal" class="hidden ad-overlay">
  <div id="adHolder" class="w-full max-w-3xl p-4 rounded-lg glass"></div>
</div>

<script>
/* ============ Core logic (client-only) ============ */

/* Precomputed hash of your admin password (SHA-256).
   NOTE: This is the hash only (can't read the password from it). */
const ADMIN_HASH = "5116bd58b6757e5a6d5396543a8c10d55a0ca3cb44d3dd1503c6ac5ae74b34f6";

/* Helpers */
function uid(){ return Math.random().toString(36).slice(2,9) }
function now(){ return Date.now() }
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)) }
function load(key, fallback){ try{ const v = JSON.parse(localStorage.getItem(key)); return v===null? fallback : (v||fallback); }catch(e){ return fallback }}

/* Categories (tabs) */
const CATEGORIES = [
  { key:'media', title:'وسائل الإعلام الآلي' },
  { key:'electronics', title:'الأجهزة الكهرو منزلية' },
  { key:'games', title:'الألعاب' },
  { key:'health', title:'الصحة ورياضة' },
  { key:'phones', title:'مقارنة الهواتف' }
];

/* SHA-256 helper */
async function sha256hex(str){
  const enc = new TextEncoder().encode(str);
  const buf = await crypto.subtle.digest('SHA-256', enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

/* Initialize demo posts if none */
if(!load('m_posts', null)) {
  save('m_posts', [
    { _id: uid(), title:'تمارين صباحية', description:'روتين صباحي سريع', media:[], link:'', categoryKey:'health', keywords:['رياضة','تمارين'], createdAt: now(), expiresAt: now()+7*24*3600*1000 },
    { _id: uid(), title:'مراجعة هاتف', description:'تحليل مواصفات الجهاز', media:[], link:'', categoryKey:'media', keywords:['مراجعة','هاتف'], createdAt: now(), expiresAt: now()+7*24*3600*1000 }
  ]);
}

/* Track visitors (local only) */
(function trackVisit(){
  const t = (parseInt(localStorage.getItem('vis_total')||'0') + 1);
  localStorage.setItem('vis_total', t);
  const ref = document.referrer || '';
  if(ref.includes('facebook.com')) localStorage.setItem('vis_fb', (parseInt(localStorage.getItem('vis_fb')||'0')+1));
  else localStorage.setItem('vis_direct', (parseInt(localStorage.getItem('vis_direct')||'0')+1));
})();

/* UI elements */
const tabsContainer = document.querySelector('.tab-scroll');
const content = document.getElementById('content');
const compareView = document.getElementById('compareView');
const compareTable = document.getElementById('compareTable');

/* build tabs */
let active = 'media';
function buildTabs(){
  tabsContainer.innerHTML='';
  CATEGORIES.forEach(c=>{
    const b = document.createElement('button');
    b.className = 'px-4 py-2 rounded-full glass fade tab-btn';
    b.textContent = c.title;
    b.onclick = ()=> setActive(c.key);
    if(c.key === active) b.classList.add('btn-accent');
    tabsContainer.appendChild(b);
  });
}
buildTabs();

/* setActive */
function setActive(key){
  active = key;
  Array.from(tabsContainer.children).forEach(btn=>{
    btn.classList.toggle('btn-accent', btn.textContent === CATEGORIES.find(x=>x.key===key).title);
  });
  document.getElementById('kw').value='';
  if(key === 'phones'){ compareView.classList.remove('hidden'); content.classList.add('hidden'); renderCompare(); }
  else{ compareView.classList.add('hidden'); content.classList.remove('hidden'); renderPosts(); }
}

/* render posts for active category */
function renderPosts(){
  const posts = (load('m_posts',[])||[]).filter(p=> p.categoryKey === active && (!p.expiresAt || p.expiresAt > now()));
  content.innerHTML = '';
  if(posts.length === 0){
    content.innerHTML = `<div class="col-span-full glass p-6 rounded-lg text-center small-muted">لا توجد منشورات في هذه الخانة بعد.</div>`;
    return;
  }
  posts.sort((a,b)=>b.createdAt - a.createdAt);
  posts.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'glass p-4 rounded-lg';
    let inner = `<div class="small-muted">${escapeHtml(p.categoryKey)} • ${new Date(p.createdAt).toLocaleString()}</div>
                 <h3 class="font-bold mt-2">${escapeHtml(p.title)} <span class="ml-2">✨</span></h3>
                 <p class="mt-2 small-muted">${escapeHtml(p.description).slice(0,160)}</p>`;
    if(p.media && p.media.length){
      const m = p.media[0];
      if(m.type.startsWith('image')) inner += `<img src="${m.url}" alt="" class="mt-3 rounded-lg w-full" />`;
      else if(m.type.startsWith('video')) inner += `<video src="${m.url}" controls class="mt-3 rounded-lg w-full"></video>`;
    }
    card.innerHTML = inner;
    content.appendChild(card);
  });
}

/* compare */
function renderCompare(){
  compareTable.innerHTML = '';
  const data = [
    { name:'iPhone 15', ram:'6GB', storage:'128GB', battery:'4000mAh' },
    { name:'Samsung S24', ram:'12GB', storage:'256GB', battery:'5000mAh' }
  ];
  data.forEach(d=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td class="p-2">${d.name}</td><td class="p-2">${d.ram}</td><td class="p-2">${d.storage}</td><td class="p-2">${d.battery}</td>`;
    compareTable.appendChild(tr);
  });
}

/* search (keywords first) */
document.getElementById('doSearch').addEventListener('click', ()=>{
  const q = document.getElementById('kw').value.trim().toLowerCase();
  if(!q){ renderPosts(); return; }
  const posts = (load('m_posts',[])||[]).filter(p=> p.categoryKey === active && (
    (p.keywords||[]).some(k=> k.toLowerCase().includes(q)) ||
    (p.title||'').toLowerCase().includes(q) ||
    (p.description||'').toLowerCase().includes(q)
  ));
  content.innerHTML = '';
  if(posts.length===0){ content.innerHTML = `<div class="glass p-6 rounded-lg small-muted text-center">لا توجد نتائج مطابقة.</div>`; return; }
  posts.forEach(p=>{
    const card = document.createElement('article'); card.className = 'glass p-4 rounded-lg';
    card.innerHTML = `<div class="small-muted">${escapeHtml(p.categoryKey)}</div><h3 class="font-bold">${escapeHtml(p.title)}</h3><p class="small-muted">${escapeHtml(p.description)}</p>`;
    content.appendChild(card);
  });
});

/* escape helper */
function escapeHtml(s){ return (s||'').toString().replaceAll('<','&lt;').replaceAll('>','&gt;') }

/* Buttons wiring */
document.getElementById('openAdmin').addEventListener('click', ()=> document.getElementById('adminModal').classList.remove('hidden'));
document.getElementById('closeAdmin').addEventListener('click', ()=> document.getElementById('adminModal').classList.add('hidden'));
document.getElementById('newPostBtn').addEventListener('click', ()=> document.getElementById('customerModal').classList.remove('hidden'));
document.getElementById('closeCustomer').addEventListener('click', ()=> document.getElementById('customerModal').classList.add('hidden'));
document.getElementById('promoteBtn').addEventListener('click', ()=> window.open("https://www.facebook.com/profile.php?id=61580406166615&mibextid=rS40aB7S9Ucbxw6v",'_blank'));
document.getElementById('shareFB').addEventListener('click', ()=> window.open("https://www.facebook.com/profile.php?id=61580406166615&mibextid=rS40aB7S9Ucbxw6v",'_blank'));

/* fill category selects */
function fillCatSelects(){
  const pCat = document.getElementById('pCat'); const custCat = document.getElementById('custCat');
  pCat.innerHTML=''; custCat.innerHTML='';
  CATEGORIES.filter(c=>c.key!=='phones').forEach(c=>{
    const o = document.createElement('option'); o.value=c.key; o.textContent=c.title; pCat.appendChild(o);
    const o2 = document.createElement('option'); o2.value=c.key; o2.textContent=c.title; custCat.appendChild(o2);
  });
}
fillCatSelects();

/* Admin login */
document.getElementById('adminConfirm').addEventListener('click', async ()=>{
  const v = document.getElementById('adminPass').value.trim();
  if(!v) return alert('أدخل كلمة الأدمن');
  const hv = await sha256hex(v);
  if(hv === ADMIN_HASH){
    document.getElementById('adminLogin').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    document.getElementById('adminPass').value='';
    refreshStats();
    renderPosts();
    showCodes(false);
  } else alert('كلمة مرور خاطئة');
});

/* Logout admin */
document.getElementById('logoutAdmin').addEventListener('click', ()=>{
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('adminLogin').classList.remove('hidden');
});

/* Generate code */
document.getElementById('genCode').addEventListener('click', ()=>{
  const codes = load('m_codes',[]);
  const code = 'MK-' + Math.random().toString(36).slice(2,8).toUpperCase();
  codes.push({ code, days:7, createdAt: now(), used:false });
  save('m_codes', codes);
  alert('تولد كود: ' + code + '\nانسخه واعطه للزبون. صالح لمرة واحدة.');
  showCodes(true);
});

/* Show codes UI */
document.getElementById('showCodes').addEventListener('click', ()=> showCodes(true));
function showCodes(force){
  const box = document.getElementById('codesBox');
  const codes = load('m_codes',[]);
  if(codes.length === 0) box.innerHTML = '<div class="small-muted">لا توجد أكواد مولدة</div>';
  else box.innerHTML = `<div class="font-semibold">الأكواد (${codes.length})</div>` + codes.map(c=>`<div class="mt-2 p-2 glass rounded flex justify-between items-center"><div>${c.code} — ${c.used? '<span class="small-muted">مستخدم</span>':'<span class="font-semibold">متاح</span>'}</div><div><button data-code="${c.code}" class="copyBtn px-2 py-1 rounded glass">نسخ</button></div></div>`).join('');
  box.classList.toggle('hidden', !force);
  box.querySelectorAll('.copyBtn').forEach(btn=> btn.onclick = ()=> { navigator.clipboard?.writeText(btn.dataset.code).then(()=> alert('نسخ الكود')); });
}

/* Publish Now (admin) */
document.getElementById('publishNow').addEventListener('click', async ()=>{
  const title = document.getElementById('pTitle').value.trim();
  const desc = document.getElementById('pDesc').value.trim();
  const kws = document.getElementById('pKw').value.split(',').map(s=>s.trim()).filter(Boolean);
  const cat = document.getElementById('pCat').value;
  const files = document.getElementById('pFiles').files;
  if(!title) return alert('أدخل عنواناً');
  const media = [];
  for(const f of files) media.push({ url: await fileToDataURL(f), type: f.type });
  const posts = load('m_posts',[]);
  const createdAt = now();
  posts.push({ _id: uid(), title, description: desc, media, link:'', categoryKey: cat, keywords: kws, createdAt, expiresAt: createdAt + 7*24*3600*1000 });
  save('m_posts', posts);
  alert('تم النشر بنجاح');
  document.getElementById('pTitle').value=''; document.getElementById('pDesc').value=''; document.getElementById('pKw').value=''; document.getElementById('pFiles').value='';
  renderPosts();
});

/* Upload Ad */
document.getElementById('uploadAd').addEventListener('click', async ()=>{
  const f = document.getElementById('adFile').files[0];
  const type = document.getElementById('adType').value;
  if(!f) return alert('اختر ملف الإعلان');
  const data = await fileToDataURL(f);
  save('m_ad', { type, data, length: type==='video'?24:5 });
  alert('تم رفع الإعلان محلياً.');
});

/* Show ad when needed */
async function showAdIfNeeded(){
  const ad = load('m_ad', null);
  const access = parseInt(localStorage.getItem('adAccessUntil')||'0',10);
  if(!ad) return;
  if(access > now()) return;
  const adModal = document.getElementById('adModal');
  const adHolder = document.getElementById('adHolder');
  adHolder.innerHTML = '';
  if(ad.type === 'video'){
    const v = document.createElement('video'); v.src = ad.data; v.controls = true; v.autoplay = true; v.style.width='100%';
    adHolder.appendChild(v);
    const info = document.createElement('div'); info.className='small-muted mt-2'; info.textContent = `شاهد ${ad.length} ثانية لتنشيط الاستخدام لـ24 ساعة.`;
    adHolder.appendChild(info);
    adModal.classList.remove('hidden');
    const interval = setInterval(()=> {
      try{ if(Math.floor(v.currentTime) >= ad.length){ clearInterval(interval); adModal.classList.add('hidden'); localStorage.setItem('adAccessUntil', (now() + 24*3600*1000)); alert('تم تفعيل الموقع 24 ساعة'); } }catch(e){}
    }, 500);
  } else {
    const img = document.createElement('img'); img.src = ad.data; img.style.width='100%';
    adHolder.appendChild(img);
    adModal.classList.remove('hidden');
    setTimeout(()=> { adModal.classList.add('hidden'); localStorage.setItem('adAccessUntil', (now() + 24*3600*1000)); alert('تم تفعيل الموقع 24 ساعة'); }, 5000);
  }
}

/* Customer redeem code */
document.getElementById('redeemCode').addEventListener('click', ()=>{
  const code = document.getElementById('customerCode').value.trim();
  if(!code) return alert('أدخل الكود');
  const codes = load('m_codes',[]);
  const found = codes.find(c=> c.code === code && !c.used);
  if(!found) return alert('الكود غير صحيح أو مستخدم');
  // allocate code in session to this user
  sessionStorage.setItem('allocated_code', code);
  document.getElementById('customerFormWrap').classList.remove('hidden');
});

/* Customer publish (one post only) */
document.getElementById('custPublish').addEventListener('click', async ()=>{
  const code = sessionStorage.getItem('allocated_code');
  if(!code) return alert('لم تتحقق من الكود');
  const title = document.getElementById('custTitle').value.trim();
  const desc = document.getElementById('custDesc').value.trim();
  const kws = document.getElementById('custKw').value.split(',').map(s=>s.trim()).filter(Boolean);
  const cat = document.getElementById('custCat').value;
  const files = document.getElementById('custFiles').files;
  if(!title) return alert('أدخل عنوان');
  const media = [];
  for(const f of files) media.push({ url: await fileToDataURL(f), type: f.type });
  const posts = load('m_posts',[]);
  const createdAt = now();
  posts.push({ _id: uid(), title, description: desc, media, link:'', categoryKey: cat, keywords: kws, createdAt, expiresAt: createdAt + 7*24*3600*1000 });
  save('m_posts', posts);
  // mark code used
  const codes = load('m_codes',[]);
  const idx = codes.findIndex(c=> c.code === code);
  if(idx>=0){ codes[idx].used = true; codes[idx].usedAt = now(); save('m_codes', codes); }
  sessionStorage.removeItem('allocated_code');
  alert('تم النشر — الكود أصبح مستخدماً.');
  document.getElementById('customerModal').classList.add('hidden');
  renderPosts();
});

/* Helpers: file->dataURL */
function fileToDataURL(file){
  return new Promise((res,rej)=>{
    const r = new FileReader();
    r.onload = ()=> res(r.result);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

/* refresh stats */
function refreshStats(){
  document.getElementById('statTotal').textContent = localStorage.getItem('vis_total') || 0;
  document.getElementById('statFB').textContent = localStorage.getItem('vis_fb') || 0;
  document.getElementById('statDirect').textContent = localStorage.getItem('vis_direct') || 0;
}

/* init */
(async function init(){
  setActive(active);
  renderPosts();
  showAdIfNeeded();
  refreshStats();
})();

</script>
</body>
  </html>
